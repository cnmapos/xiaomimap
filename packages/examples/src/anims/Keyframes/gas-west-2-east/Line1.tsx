/* eslint-disable @typescript-eslint/no-unused-expressions */
import {
  AnimationController2,
  AnimationTrack2,
  PathAnimationTarget,
} from '@hztx/animations';

import {
  Cartesian3,
  Coordinate,
  createViewer,
  IViewer,
  LineEntity,
  ModelEntity,
  smoothLine,
} from '@hztx/core';
import React, { useEffect, useRef } from 'react';
import MapContainer from '../../../components/map-container';
import { Button } from 'antd';

function GasW2TELine1() {
  const context = useRef<{ viewer: IViewer }>({
    viewer: null,
  });
  const aniCtr = useRef<AnimationController2>();
  useEffect(() => {
    context.current.viewer = createViewer('map', {
      key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5YjliYjIwYi0zMWE0LTQ4MTgtYWU4NC0wNWZmNTFmZjVhYmMiLCJpZCI6MjY1NzYxLCJpYXQiOjE3MzU1NzA3MTl9.BOJDK-WqsLV-QcQhbnAEf-wG1mtkftG1BYV6JIv0VoI',
    });
    context.current.viewer.addRasterLayer({
      url: 'https://tiles1.geovisearth.com/base/v1/cia/{z}/{x}/{y}?format=webp&tmsIds=w&token=fa74f216c7265ac713a224dcd0a4d0f20e27b61051ed729b587111b4c410528b',
    });

    aniCtr.current = new AnimationController2([]);

    init();

    return () => {
      context.current.viewer?.destroy();
    };
  }, []);

  const positions: Coordinate[] = [
    [86.16473957643825, 41.72347859012383, 9.313225746154785e-10],
    [86.26144961147457, 41.78491713858471, 254.44719369894526],
    [86.46638702050531, 41.871194743890975, 193.65633994251928],
    [86.7620676961993, 41.97651180758813, -67.23850080140383],
    [87.13098671624802, 42.09500455218589, -407.73967674653306],
    [87.55548489505226, 42.22086839150831, -719.5396016539557],
    [88.01765560894856, 42.34845878292614, -920.0087810088977],
    [88.49929276432819, 42.47236858008973, -961.6088248304742],
    [88.98187819797845, 42.58747961020936, -837.2155545628511],
    [89.44660466377314, 42.68898556263881, -581.3410009220315],
    [89.87442904107175, 42.772383258445714, -267.25275867151976],
    [90.2461497361245, 42.833429883687984, 9.313225746154785e-10],
    [90.56886575751903, 42.884260158892545, 269.4870028025234],
    [90.86695588694965, 42.937099898789704, 626.2754574157085],
    [91.14703720014107, 42.987932745174646, 1008.1967308104665],
    [91.41568233438942, 43.032669229142215, 1360.5911641507219],
    [91.67942194760579, 43.06715501883347, 1635.5345187732416],
    [91.94473991003375, 43.087174760838664, 1791.8668894382554],
    [92.21806076899688, 43.088451736736246, 1796.0256802152855],
    [92.50572913778655, 43.06664360806745, 1623.6844005297498],
    [92.81398077135854, 43.01733462911488, 1262.199523480458],
    [93.148905212391, 42.93602487004902, 713.8682101207779],
    [93.5164000306841, 42.818117215837155, 0],
    [93.92547420840053, 42.64853536986588, -884.8712480272438],
    [94.3738298079494, 42.42261396025188, -1856.163511983048],
    [94.85041295901588, 42.15139640159673, -2751.7526680946953],
    [95.34452508937561, 41.84609506058469, -3435.9731618888004],
    [95.84592619499918, 41.51810966674381, -3810.8190048542892],
    [96.34489849702761, 41.17902746054263, -3823.6071186297954],
    [96.83227200972655, 40.84060865500756, -3471.0724560180847],
    [97.29941443022116, 40.51476165630813, -2799.8749411557483],
    [97.73818823088226, 40.21351279770157, -1903.515157428752],
    [98.14087786631637, 39.948975091864824, -915.6734382801357],
    [98.50008960445255, 39.73331971933278, 9.313225746154785e-10],
    [98.82136374357874, 39.56301183128056, 703.2929560461218],
    [99.11716646183727, 39.423320825420575, 1171.5876847228124],
    [99.39052049128468, 39.30962681158664, 1415.3264786180696],
    [99.6442856573944, 39.217278915879575, 1458.7125260820874],
    [99.88118554230218, 39.14159927665749, 1336.8624440144108],
    [100.10382947158234, 39.07788591923995, 1093.480579526774],
    [100.31473019219266, 39.02141499037569, 779.0520012510765],
    [100.5163175241218, 38.96744271691352, 449.55168534518583],
    [100.71094820390837, 38.91120736552408, 165.66799058199328],
    [100.90091209384619, 38.847931420487306, -7.461056507761345],
    [101.08843490585924, 38.77282416349997, 0],
    [101.26349051823208, 38.68962958998803, 120.91379571076995],
    [101.41771916518482, 38.60579153014493, 229.96517099676805],
    [101.55578677241333, 38.52203384660089, 316.9865538168967],
    [101.68234266352512, 38.43905011051349, 375.5015117489268],
    [101.80201845680313, 38.35750931591295, 401.99340904086125],
    [101.91942805305226, 38.27805971726217, 395.4334480937148],
    [102.03916855584573, 38.20133081300175, 357.06809759453967],
    [102.16582199357812, 38.127933499253444, 290.4658988697127],
    [102.30395772419918, 38.05845841532502, 201.8236456842668],
    [102.45813539855578, 37.993472496838685, 100.53192837565784],
    [102.63290833705005, 37.93351374381581, 0],
    [102.82381520607639, 37.87708366527938, -63.44688080971971],
    [103.02331045316933, 37.82263958475328, -73.95070114063256],
    [103.23132465641746, 37.770625982571985, -45.129975670623374],
    [103.44779714408222, 37.72148535550458, 9.457976195811119],
    [103.67267662644426, 37.67565825744466, 76.34002167061968],
    [103.90592181680107, 37.633583348957, 142.15514868766948],
    [104.1475020448056, 37.59569745485891, 193.68734800733972],
    [104.39739786550788, 37.562435628875775, 217.90345165235075],
    [104.65560166762842, 37.534231224246916, 201.99594005192506],
    [104.9221182847585, 37.511515968965156, 133.43073488316682],
    [105.19696561334824, 37.49472004411292, 0],
    [105.47853398773893, 37.496046898790276, -80.19081199250154],
    [105.76608418370499, 37.52228751783236, -12.737830242340488],
    [106.06087805909397, 37.56574112691028, 157.79143056227994],
    [106.36407853588597, 37.61869449226804, 388.35703260573285],
    [106.67674352358392, 37.67342391451684, 635.4566619103377],
    [106.99981746465151, 37.722196090404076, 854.2843446144007],
    [107.33412083627967, 37.757267860339915, 999.0375170715827],
    [107.68033799822668, 37.770884842272146, 1024.3719376681795],
    [108.0390038476955, 37.75527901187097, 888.0044534007335],
    [108.41048982418036, 37.702665424431785, 554.4648709433555],
    [108.79498989346946, 37.60523848544693, 0],
    [109.19385445999337, 37.458496783781825, -603.5567943371576],
    [109.60675723849852, 37.26785466882375, -1064.450027422179],
    [110.0313402654415, 37.04038497377353, -1366.0667642902151],
    [110.46540364622228, 36.783189949002775, -1498.670601474021],
    [110.9069243918115, 36.503399038223314, -1464.0844166158786],
    [111.35406981279985, 36.208164982046675, -1279.325741163305],
    [111.80520605805759, 35.90465872421755, -979.1927404159067],
    [112.2589024818401, 35.60006379899898, -617.8008824660507],
    [112.7139325760602, 35.30157100684253, -269.07306820232503],
    [113.16927222129146, 35.01637424065702, -26.18877318995645],
    [113.62409599955194, 34.75166830900873, 0],
    [114.0928770484407, 34.49562294201976, -279.51534384740603],
    [114.58520227513553, 34.233188622661444, -767.8154342021344],
    [115.09315211964729, 33.96683257944674, -1325.6428492395114],
    [115.60893128063942, 33.699162952261304, -1838.310478119609],
    [116.1248747702573, 33.43293172459235, -2217.3237534739405],
    [116.63345197963079, 33.17103153477837, -2401.0629329562457],
    [117.12726763158796, 32.9164871067217, -2354.5118379086725],
    [117.59905857177779, 32.67244209278435, -2068.0236140575767],
    [118.04168548524976, 32.44214212735895, -1555.1188961223893],
    [118.44811880699837, 32.22891483831864, -849.3164297645587],
    [118.81141830762019, 32.03614744820841, 0],
    [119.15785451377157, 31.852281962047922, 849.417755790706],
    [119.51092497846179, 31.666960708622767, 1619.2205581439641],
    [119.85970784621834, 31.48549212437966, 2324.912347109873],
    [120.19344753634891, 31.31330192996852, 2953.197242667303],
    [120.50154150080611, 31.155921743847404, 3464.0374833426954],
    [120.77351348199717, 31.0189702728683, 3794.9438132299965],
    [120.99897238039553, 30.90812824980709, 3867.4937154071845],
    [121.16755617941483, 30.82910780387702, 3596.073873095277],
    [121.26886078682634, 30.78761624933085, 2898.848182070594],
    [121.29235414166723, 30.789313359468313, 1710.9614390888237],
  ].map((p) => [p[0], p[1]]);

  // 初始化
  const init = () => {
    if (aniCtr.current) {
      const track = new AnimationTrack2(context.current.viewer, []);
      aniCtr.current.addTrack(track);

      // 创建基础线实体
      const lineEty = new LineEntity({ positions: positions });
      context.current.viewer.addEntity(lineEty);

      //  ----->
      // [   start,     start + startDelay,   start + startDelay + duration,    end ]
      //   插入viewer        开始动画                       执行动画               移除

      // 创建轨迹动画对象
      const pathAnimationTarget = new PathAnimationTarget({
        baseEntity: lineEty,
        isShowBaseEntity: false,
        start: 0,
        end: 30 * 1000,
        startDelay: 2000,
        endStay: 3000,

        startValue: positions[0],
        endValue: positions[positions.length - 1],

        tracked: true,

        camera: {
          distance: 307953,
        },

        billboard: {
          image: 'assets/circle.png',
          positions: positions[0],
          width: 16,
          height: 16,
        },
        onBefore: () => {
          console.log('onBefore执行');
          console.time('动画时长统计');
        },
        onAfter: () => {
          console.log('onAfter执行');
          console.timeEnd('动画时长统计');
        },
      });
      pathAnimationTarget.setStyle({
        width: 3,
        color: '#ff0000',
        outlineWidth: 1,
        outlineColor: '#00ff00',
      });
      // 新增动画对象到图层里
      track.add(pathAnimationTarget);
    }
  };

  function play() {
    aniCtr.current && aniCtr.current.play();
  }

  function pause() {
    aniCtr.current && aniCtr.current.pause();
  }

  function replay() {
    aniCtr.current && aniCtr.current.reset();
    play();
  }

  return (
    <MapContainer>
      <div style={{ width: '100%', height: '100%' }} id="map"></div>
      <div>
        <div className="hz-player">
          <div>
            <Button className="hz-btn" onClick={play}>
              播放
            </Button>
            <Button className="hz-btn" onClick={pause}>
              暂停
            </Button>
            <Button className="hz-btn" onClick={replay}>
              重新播放
            </Button>
          </div>
        </div>
        <div className="hz-style"></div>
      </div>
    </MapContainer>
  );
}

export default GasW2TELine1;
